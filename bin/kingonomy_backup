require 'kingonomy/quote_retriever'
require 'kingonomy/stock_sorter'
require 'kingonomy/report'

stock_symbols = ARGV.empty? ? ["AAPL", "MSFT", "GRPN", "ADBE", "MMM"] : ARGV
quote_retriever = Kingonomy::QuoteRetriever.new
display_fields = [:symbol, :name, :pe, :eps, :iad, 
  :yield, :divfreq, :prbook, :bid, :wk52hi, :wk52lo]
stock_quotes = quote_retriever.get_quotes(stock_symbols, display_fields)

stock_sorter = Kingonomy::StockSorter.new
stock_sorter.sort(stock_quotes)

report = Kingonomy::Report.new(stock_quotes)
table = report.create_report_table(stock_quotes, display_fields) do |row| 
    row[:yield].to_f > 2 &&
      row[:pe].to_f < 15
end
table.rename_column(:divfreq, :fq)
p table
